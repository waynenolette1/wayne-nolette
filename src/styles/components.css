/**
 * Shared component styles â€” buttons, cards, layout patterns, info boxes, tags
 * Imported globally via BaseLayout.astro
 */

/* ======================
 * Content Disclaimer Component
 * ====================== */
.content-disclaimer {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border-subtle);
  border-radius: var(--radius-md);
  font-size: var(--font-size-xs);
  color: var(--color-text-subtle);
  margin-bottom: var(--spacing-lg);
  letter-spacing: var(--letter-spacing-subtle);
}

.content-disclaimer svg {
  flex-shrink: 0;
  opacity: var(--opacity-muted);
}

/* ======================
 * Back Link Component
 * ====================== */
.back-link {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-base);
  color: var(--color-text-muted);
  margin-bottom: var(--spacing-lg);
  transition: color var(--transition-fast);
  font-weight: var(--font-weight-medium);
  letter-spacing: var(--letter-spacing-subtle);
  min-height: var(--touch-target);
}

.back-link svg {
  transition: transform var(--transition-bounce);
}

/* Only apply hover effects on devices that support hover */
@media (hover: hover) {
  .back-link:hover {
    color: var(--color-link);
    text-decoration: none;
  }

  .back-link:hover svg {
    transform: translateX(calc(-1 * var(--translate-xs)));
  }
}

.back-link:active {
  color: var(--color-link);
  transform: scale(var(--scale-press));
}

.back-link:active svg {
  transform: translateX(calc(-1 * var(--translate-2xs)));
}

/* Focus state for keyboard accessibility */
.back-link:focus-visible {
  outline: none;
  color: var(--color-link);
  border-radius: var(--radius-sm);
  box-shadow:
    inset 0 0 0 2px var(--color-accent-40),
    0 0 0 2px var(--color-bg),
    0 0 0 4px var(--color-accent-30);
}

/* ======================
 * Footer CTA Component
 * ====================== */
.footer-cta {
  text-align: center;
  padding: var(--spacing-xl) var(--spacing-2xl);
  background: linear-gradient(
    135deg,
    var(--color-accent-10) 0%,
    var(--color-gradient-purple-10) 100%
  );
  border: 1px solid var(--color-accent-20);
  border-radius: var(--radius-xl);
  margin-bottom: var(--spacing-xl);
  position: relative;
  overflow: hidden;
}

.footer-cta::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: var(--border-accent);
  background: linear-gradient(
    90deg,
    var(--color-accent),
    var(--color-gradient-purple)
  );
}

.footer-cta p {
  margin: 0 0 var(--spacing-md) 0;
  color: var(--color-text);
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-medium);
  line-height: var(--line-height-loose);
  letter-spacing: var(--letter-spacing-compact);
}

/* ======================
 * Button Base Styles
 * ====================== */

/* Primary Button - Clean gradient background */
.cta-primary,
.contact-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-xl);
  /* Ensure minimum touch target size for mobile (44px Apple HIG) */
  min-height: var(--touch-target);
  background: linear-gradient(
    135deg,
    var(--color-accent) 0%,
    var(--color-link-hover) 100%
  );
  color: var(--color-btn-text);
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-semibold);
  text-decoration: none;
  transition: all var(--transition-bounce);
  box-shadow: 0 4px 14px var(--color-accent-30);
  text-align: center;
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-subtle);
  -webkit-tap-highlight-color: transparent;
  position: relative;
  overflow: hidden;
  border: none;
  cursor: pointer;
  z-index: 1;
  /* Remove Safari default focus outline */
  outline: none;
  appearance: none;
  -webkit-appearance: none;
}

/* Only apply hover effects on devices that support hover */
@media (hover: hover) {
  .cta-primary:hover,
  .contact-btn:hover {
    background: linear-gradient(
      135deg,
      var(--color-link-hover) 0%,
      var(--color-gradient-purple) 100%
    );
    transform: translateY(var(--lift-sm));
    box-shadow: 0 8px 24px var(--color-accent-40);
    text-decoration: none;
    color: var(--color-btn-text);
  }
}

/* Active state for all devices (including touch) */
.cta-primary:active,
.contact-btn:active {
  transform: scale(0.98);
  box-shadow: 0 1px 4px var(--color-overlay-black-20);
  color: var(--color-btn-text);
}

/* Clean focus state without Safari outline */
.cta-primary:focus-visible,
.contact-btn:focus-visible {
  outline: none;
  box-shadow:
    0 2px 8px var(--color-overlay-black-15),
    0 0 0 2px var(--color-bg),
    0 0 0 4px var(--color-accent);
  color: var(--color-btn-text);
}

/* Secondary Button - Outlined with subtle background */
.cta-secondary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-lg);
  /* Ensure minimum touch target size for mobile (44px Apple HIG) */
  min-height: var(--touch-target);
  background: var(--color-bg-subtle);
  color: var(--color-text);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  font-weight: var(--font-weight-medium);
  text-decoration: none;
  transition: all var(--transition-slow);
  position: relative;
  overflow: visible;
  text-align: center;
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-subtle);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  /* Remove Safari default focus outline */
  outline: none;
  appearance: none;
  -webkit-appearance: none;
}

/* Premium glow effect behind secondary buttons */
.cta-secondary::after {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: calc(var(--radius-md) + 4px);
  background: radial-gradient(
    ellipse at center,
    var(--color-accent-25) 0%,
    var(--color-gradient-purple-15) 50%,
    transparent 70%
  );
  opacity: 0;
  filter: blur(var(--blur-lg));
  z-index: -1;
  transition: opacity var(--transition-slow) cubic-bezier(0.22, 1, 0.36, 1);
  pointer-events: none;
}

/* Only apply hover effects on devices that support hover */
@media (hover: hover) {
  .cta-secondary:hover {
    border-color: var(--color-link);
    color: var(--color-link);
    background: var(--color-bg-elevated);
    text-decoration: none;
    transform: translateY(var(--lift-sm));
    box-shadow: var(--shadow-card);
  }

  .cta-secondary:hover::after {
    opacity: var(--opacity-soft);
  }
}

/* Active state for all devices (including touch) */
.cta-secondary:active {
  transform: scale(var(--scale-press));
  box-shadow: none;
  color: var(--color-link);
  border-color: var(--color-link);
  background: var(--color-bg-elevated);
}

/* Clean focus state without Safari outline */
.cta-secondary:focus-visible {
  outline: none;
  border-color: var(--color-accent);
  box-shadow:
    inset 0 0 0 1px var(--color-accent-30),
    0 0 0 3px var(--color-bg),
    0 0 0 5px var(--color-accent-40);
}

.cta-secondary:focus-visible::after {
  opacity: var(--opacity-medium);
}

/* ======================
 * Footer Navigation Component
 * ====================== */
.footer-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md) 0;
}

.nav-link {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-sm);
  letter-spacing: var(--letter-spacing-subtle);
  color: var(--color-text-muted);
  font-weight: var(--font-weight-medium);
  padding: var(--spacing-sm) var(--spacing-md);
  min-height: var(--touch-target); /* Apple HIG touch target */
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
}

.nav-link svg {
  transition: transform var(--transition-bounce);
}

/* Only apply hover effects on devices that support hover */
@media (hover: hover) {
  .nav-link:hover {
    color: var(--color-link);
    background: var(--color-bg-subtle);
    text-decoration: none;
  }
}

/* Active state for touch devices */
.nav-link:active {
  color: var(--color-link);
  background: var(--color-bg-subtle);
  transform: scale(var(--scale-press));
}

/* Focus state for keyboard accessibility */
.nav-link:focus-visible {
  outline: none;
  color: var(--color-link);
  background: var(--color-bg-subtle);
  box-shadow:
    inset 0 0 0 2px var(--color-accent-40),
    0 0 0 2px var(--color-bg),
    0 0 0 4px var(--color-accent-30);
}

@media (hover: hover) {
  .nav-link:first-child:hover svg {
    transform: translateX(calc(-1 * var(--translate-xs)));
  }

  .nav-link:last-child:hover svg {
    transform: translateX(var(--translate-xs));
  }
}

.nav-link:first-child:active svg {
  transform: translateX(calc(-1 * var(--translate-2xs)));
}

.nav-link:last-child:active svg {
  transform: translateX(var(--translate-2xs));
}

/* ======================
 * Page Header Component
 * ====================== */
.page-header {
  text-align: center;
  margin-bottom: var(--spacing-2xl);
  padding-top: var(--spacing-lg);
  padding-bottom: var(--spacing-xl);
  border-bottom: 1px solid var(--color-border-subtle);
  position: relative;
  overflow: visible;
}

/* Subtle gradient orb behind page header */
.page-header::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 400px;
  height: 200px;
  transform: translate(-50%, -50%);
  background: radial-gradient(
    ellipse at center,
    var(--color-accent-15) 0%,
    var(--color-gradient-purple-10) 30%,
    transparent 70%
  );
  filter: blur(var(--blur-3xl));
  opacity: var(--opacity-half);
  pointer-events: none;
  z-index: -1;
}

.page-title {
  font-size: var(--font-size-9xl);
  font-weight: var(--font-weight-bold);
  letter-spacing: var(--letter-spacing-tighter);
  margin-bottom: var(--spacing-md);
  background: linear-gradient(
    135deg,
    var(--color-text) 0%,
    var(--color-text-muted) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  position: relative;
  z-index: 1;
}

.page-subtitle {
  color: var(--color-text-muted);
  font-size: var(--font-size-3xl);
  line-height: var(--line-height-prose);
  letter-spacing: var(--letter-spacing-snug);
  max-width: 60ch;
  margin: 0 auto;
}

.page-subtitle em {
  font-style: italic;
  color: var(--color-link);
}

/* ======================
 * Section Title Component
 * ====================== */
.section-title {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wider);
  margin: 0 0 var(--spacing-lg) 0;
  padding-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border-subtle);
}

.section-title svg {
  color: var(--color-link);
}

/* ======================
 * Status Badge Component
 * Unified pill system - uses spacing variables for consistency
 * ====================== */
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-2xs);
  font-size: var(--font-size-2xs);
  font-weight: var(--font-weight-medium);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  padding: var(--spacing-2xs) var(--spacing-sm);
  border-radius: var(--radius-full);
  /* Fallback for browsers without color-mix() support */
  background: rgba(128, 128, 128, 0.1);
  background: color-mix(
    in srgb,
    var(--status-color, var(--color-text-muted)) 10%,
    transparent
  );
  color: var(--status-color, var(--color-text-muted));
  /* Fallback border for browsers without color-mix() */
  border: 1px solid rgba(128, 128, 128, 0.2);
  border: 1px solid
    color-mix(
      in srgb,
      var(--status-color, var(--color-text-muted)) 20%,
      transparent
    );
}

.status-badge[data-status='success'],
.status-badge[data-status='accepted'] {
  --status-color: var(--color-success);
}

.status-badge[data-status='warning'],
.status-badge[data-status='proposed'] {
  --status-color: var(--color-warning);
}

.status-badge[data-status='deprecated'],
.status-badge[data-status='superseded'] {
  --status-color: var(--color-text-muted);
}

/* ======================
 * Content Table System
 * Unified table styling for all content types (writing, case studies, ADRs)
 * Tables are rendered from markdown via rehype and wrapped in .table-scroll
 * ====================== */

/* Scrollable wrapper (auto-added by rehype plugin) */
.table-scroll {
  width: 100%;
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
  margin: var(--spacing-xl) 0;
  border-radius: var(--radius-lg);
  /* Subtle container styling */
  border: 1px solid var(--color-border-subtle);
  background: var(--color-bg);
}

.table-scroll > table {
  width: 100%;
  margin: 0;
}

/* Base table - clean, readable structure */
.table-scroll table {
  width: 100%;
  border-collapse: collapse;
  font-size: var(--font-size-md);
  line-height: var(--line-height-relaxed);
  /* Use tabular numbers for numeric data alignment */
  font-variant-numeric: tabular-nums;
}

/* Header row - clear hierarchy, readable */
.table-scroll th {
  padding: var(--spacing-md) var(--spacing-lg);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  color: var(--color-text-muted);
  background: var(--color-bg-elevated);
  border-bottom: 2px solid var(--color-border);
  text-align: left;
}

/* Body cells - clear contrast, good readability */
.table-scroll td {
  padding: var(--spacing-md) var(--spacing-lg);
  color: var(--color-text);
  border-bottom: 1px solid var(--color-border-subtle);
  vertical-align: top;
  line-height: var(--line-height-relaxed);
}

/* Last row has no bottom border */
.table-scroll tr:last-child td {
  border-bottom: none;
}

/* Numeric columns - right aligned with tabular nums */
.table-scroll td:nth-child(n + 2):not(:last-child) {
  /* Auto right-align middle columns that typically contain numbers */
  font-variant-numeric: tabular-nums;
}

/* First column is typically labels - left aligned, slightly muted */
.table-scroll td:first-child {
  color: var(--color-text);
  font-weight: var(--font-weight-medium);
}

/* Zebra striping for long tables - very subtle */
.table-scroll tbody tr:nth-child(odd) {
  /* Fallback for browsers without color-mix() */
  background: rgba(17, 17, 17, 0.3);
  background: color-mix(in srgb, var(--color-bg-subtle) 30%, transparent);
}

/* Row hover - subtle highlight, no transform */
@media (hover: hover) {
  .table-scroll tbody tr:hover td {
    background: var(--color-bg-subtle);
  }
}

/* Focus state for accessibility - unified ring pattern */
.table-scroll:focus-within {
  outline: none;
  box-shadow:
    inset 0 0 0 2px var(--color-accent-40),
    0 0 0 3px var(--color-bg),
    0 0 0 5px var(--color-accent-30);
}

/* Mobile responsive - horizontal scroll with fade indicator */
@media (max-width: 768px) {
  .table-scroll {
    /* Scroll shadow indicators */
    background:
      /* Left shadow */
      linear-gradient(to right, var(--color-bg) 0, transparent 20px),
      /* Right shadow */
        linear-gradient(to left, var(--color-bg) 0, transparent 20px),
      /* Left shadow cover */
        radial-gradient(
          farthest-side at 0 50%,
          var(--color-overlay-black-15),
          transparent
        ),
      /* Right shadow cover */
        radial-gradient(
          farthest-side at 100% 50%,
          var(--color-overlay-black-15),
          transparent
        );
    background-position:
      left center,
      right center,
      left center,
      right center;
    background-repeat: no-repeat;
    background-size:
      40px 100%,
      40px 100%,
      15px 100%,
      15px 100%;
    background-attachment: local, local, scroll, scroll;
  }

  .table-scroll table {
    min-width: 500px;
  }

  .table-scroll th,
  .table-scroll td {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-sm);
  }

  .table-scroll th {
    font-size: var(--font-size-2xs);
  }
}

/* Extra small screens */
@media (max-width: 400px) {
  .table-scroll table {
    min-width: 400px;
  }

  .table-scroll th,
  .table-scroll td {
    padding: var(--spacing-2xs) var(--spacing-xs);
    font-size: var(--font-size-xs);
  }
}

/* Print styles for tables */
@media print {
  .table-scroll {
    overflow: visible;
    border: 1px solid #000;
  }

  .table-scroll th,
  .table-scroll td {
    border: 1px solid #ccc;
    padding: 6pt 8pt;
  }

  .table-scroll th {
    background: #f5f5f5 !important;
    color: #000;
  }
}

/* Reduced motion - disable hover transforms */
@media (prefers-reduced-motion: reduce) {
  .table-scroll tbody tr {
    transition: none;
  }
}

/* ======================
 * Table of Contents Component
 * Shared TOC styles for PostLayout and CaseStudyLayout
 * ====================== */

/* Content wrapper for TOC layout */
.content-wrapper {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--spacing-lg);
  position: relative;
  /* Prevent grid children from overflowing container */
  max-width: 100%;
  min-width: 0;
}

/* Grid children need min-width: 0 to allow shrinking */
.content-wrapper > * {
  min-width: 0;
}

@media (min-width: 1100px) {
  .content-wrapper {
    grid-template-columns: 1fr var(--toc-width);
  }
}

/* Desktop Table of Contents */
.table-of-contents {
  display: none;
}

@media (min-width: 1100px) {
  .table-of-contents {
    display: block;
    position: sticky;
    top: calc(
      var(--header-height) + var(--spacing-lg) + env(safe-area-inset-top, 0px)
    );
    height: fit-content;
    max-height: calc(
      100vh - var(--header-height) - var(--spacing-2xl) -
        env(safe-area-inset-top, 0px)
    );
    overflow-y: auto;
    order: 2;
    padding: var(--spacing-sm) 0 var(--spacing-sm) var(--spacing-md);
    border-left: 1px solid var(--color-border-subtle);
    font-size: var(--font-size-sm);
  }
}

.toc-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-widest);
  color: var(--color-text-subtle);
  margin-bottom: var(--spacing-sm);
  padding-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border-subtle);
}

.toc-header svg {
  opacity: var(--opacity-medium);
}

.toc-nav {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-2xs);
}

.toc-nav a {
  display: block;
  padding: var(--spacing-sm);
  color: var(--color-text-muted);
  text-decoration: none;
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
  border-left: 2px solid transparent;
  line-height: var(--line-height-snug);
  font-size: var(--font-size-xs);
  letter-spacing: var(--letter-spacing-subtle);
  position: relative;
  overflow: hidden;
}

/* Shine sweep effect on TOC links */
.toc-nav a::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    var(--color-accent-10),
    transparent
  );
  /* Use transform instead of left for GPU acceleration */
  transform: translateX(-100%);
  transition: transform var(--transition-slower) cubic-bezier(0.22, 1, 0.36, 1);
}

@media (hover: hover) {
  .toc-nav a:hover {
    color: var(--color-link);
    background: var(--color-bg);
    text-decoration: none;
  }

  .toc-nav a:hover::before {
    transform: translateX(100%);
  }
}

.toc-nav a:focus-visible {
  outline: none;
  color: var(--color-link);
  box-shadow:
    inset 0 0 0 1px var(--color-accent-40),
    0 0 0 2px var(--color-bg),
    0 0 0 4px var(--color-accent-30);
}

.toc-nav a.active {
  color: var(--color-link);
  background: linear-gradient(
    90deg,
    var(--color-accent-15) 0%,
    var(--color-gradient-purple-08) 100%
  );
  border-left-color: var(--color-link);
  box-shadow: 0 2px 8px var(--color-accent-10);
  animation: tocActiveSlide 0.25s cubic-bezier(0.22, 1, 0.36, 1);
}

@keyframes tocActiveSlide {
  from {
    background-position: -100% 0;
    border-left-color: transparent;
  }
  to {
    background-position: 0 0;
    border-left-color: var(--color-link);
  }
}

/* ======================
 * Mobile TOC Component
 * ====================== */

/* Mobile TOC Toggle Button */
.mobile-toc-toggle {
  display: none;
  position: fixed;
  bottom: calc(
    var(--spacing-lg) + var(--spacing-3xl) + var(--spacing-sm) +
      env(safe-area-inset-bottom, 0px)
  );
  right: calc(var(--spacing-lg) + env(safe-area-inset-right, 0px));
  z-index: calc(var(--z-header) - 1);
  padding: var(--spacing-sm) var(--spacing-md);
  min-height: var(--touch-target);
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-full);
  color: var(--color-text);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  letter-spacing: var(--letter-spacing-subtle);
  cursor: pointer;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-fast);
  align-items: center;
  gap: var(--spacing-xs);
  overflow: visible;
}

/* Premium glow effect behind mobile TOC toggle */
.mobile-toc-toggle::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: var(--radius-full);
  background: radial-gradient(
    ellipse at center,
    var(--color-accent-35) 0%,
    var(--color-gradient-purple-20) 50%,
    transparent 70%
  );
  opacity: 0;
  filter: blur(var(--blur-lg));
  z-index: -1;
  transition: opacity var(--transition-slow) cubic-bezier(0.22, 1, 0.36, 1);
  pointer-events: none;
}

.mobile-toc-toggle svg {
  transition: transform var(--transition-base) cubic-bezier(0.34, 1.56, 0.64, 1);
}

@media (hover: hover) {
  .mobile-toc-toggle:hover {
    background: var(--color-bg-subtle);
    border-color: var(--color-accent);
    transform: translateY(var(--lift-sm));
  }

  .mobile-toc-toggle:hover::before {
    opacity: var(--opacity-medium);
  }

  .mobile-toc-toggle:hover svg {
    transform: scale(1.1);
  }
}

.mobile-toc-toggle:focus-visible {
  outline: none;
  box-shadow:
    inset 0 0 0 2px var(--color-accent-40),
    0 0 0 3px var(--color-bg),
    0 0 0 5px var(--color-accent-30);
}

.mobile-toc-toggle.active {
  background: var(--color-accent);
  color: var(--color-btn-text);
  border-color: var(--color-accent);
}

@media (max-width: 1100px) {
  .mobile-toc-toggle {
    display: flex;
    min-height: var(--touch-target);
  }
}

@media (max-width: 640px) {
  .mobile-toc-toggle {
    bottom: calc(
      var(--spacing-md) + var(--touch-target) + var(--spacing-sm) +
        env(safe-area-inset-bottom, 0px)
    );
    right: calc(var(--spacing-md) + env(safe-area-inset-right, 0px));
  }
}

/*
 * When mobile TOC toggle is present on article pages, push the scroll-top button
 * higher to avoid overlap. The TOC toggle uses different positioning at different
 * breakpoints, so we need to match those calculations.
 *
 * TOC toggle position at 640px-1100px (tablet):
 *   bottom: var(--spacing-lg) + var(--spacing-3xl) + var(--spacing-sm) = 2rem + 6rem + 0.5rem = 136px
 *   height: ~40px (with padding)
 *
 * TOC toggle position at <640px (mobile):
 *   bottom: var(--spacing-md) + var(--touch-target) + var(--spacing-sm) = 1rem + 44px + 0.5rem = 68px
 *   height: ~40px (with padding)
 *
 * Scroll-top needs to be positioned above the TOC toggle with adequate spacing.
 * Uses :has() selector - browsers without support will have scroll-top at default position.
 */
@supports selector(body:has(.mobile-toc-toggle)) {
  @media (max-width: 1100px) and (min-width: 641px) {
    body:has(.mobile-toc-toggle) .scroll-top {
      /* Position above the TOC toggle on tablet: TOC bottom (136px) + TOC height (~44px) + gap (8px) */
      bottom: calc(
        var(--spacing-lg) + var(--spacing-3xl) + var(--spacing-sm) +
          var(--touch-target) + var(--spacing-sm) +
          env(safe-area-inset-bottom, 0px)
      );
    }
  }

  @media (max-width: 640px) {
    body:has(.mobile-toc-toggle) .scroll-top {
      /* Position above the TOC toggle on mobile: TOC bottom (68px) + TOC height (~44px) + gap (4px) */
      bottom: calc(
        var(--spacing-md) + var(--touch-target) + var(--spacing-sm) +
          var(--touch-target) + var(--spacing-xs) +
          env(safe-area-inset-bottom, 0px)
      );
    }
  }
}

/* Mobile TOC Backdrop */
.mobile-toc-backdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--color-backdrop);
  z-index: var(--z-modal);
  opacity: 0;
  transition: opacity var(--transition-base);
}

.mobile-toc-backdrop.active {
  display: block;
  opacity: 1;
}

/* Mobile TOC Panel */
.mobile-toc-panel {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  max-height: 75dvh;
  background: var(--color-bg);
  border-top-left-radius: var(--radius-xl);
  border-top-right-radius: var(--radius-xl);
  z-index: calc(var(--z-modal) + 1);
  transform: translateY(100%);
  transition: transform var(--transition-base);
  overflow: hidden;
  box-shadow: 0 -4px 20px var(--color-backdrop);
  display: flex;
  flex-direction: column;
}

.mobile-toc-panel.active {
  transform: translateY(0);
}

.mobile-toc-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md) var(--spacing-lg);
  border-bottom: 1px solid var(--color-border);
  position: sticky;
  top: 0;
  background: var(--color-bg);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-widest);
  color: var(--color-text-subtle);
  backdrop-filter: blur(var(--blur-md));
  -webkit-backdrop-filter: blur(var(--blur-md));
  z-index: 1;
  box-shadow: 0 1px 0 var(--color-border-subtle);
}

.mobile-toc-close {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: var(--touch-target);
  min-height: var(--touch-target);
  background: transparent;
  border: none;
  border-radius: var(--radius-sm);
  color: var(--color-text-muted);
  cursor: pointer;
  transition: all var(--transition-fast);
}

@media (hover: hover) {
  .mobile-toc-close:hover {
    background: var(--color-bg-subtle);
    color: var(--color-text);
  }
}

.mobile-toc-close:focus-visible {
  outline: none;
  box-shadow:
    inset 0 0 0 2px var(--color-accent-40),
    0 0 0 3px var(--color-bg),
    0 0 0 5px var(--color-accent-30);
}

.mobile-toc-nav {
  padding: var(--spacing-md) var(--spacing-lg);
  padding-bottom: calc(var(--spacing-xl) + env(safe-area-inset-bottom, 0px));
  display: flex;
  flex-direction: column;
  gap: var(--spacing-2xs);
  overflow-y: auto;
  flex: 1;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

.mobile-toc-nav a {
  display: block;
  padding: var(--spacing-md) var(--spacing-md);
  min-height: var(--touch-target);
  color: var(--color-text-muted);
  text-decoration: none;
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
  font-size: var(--font-size-md);
  line-height: var(--line-height-snug);
  letter-spacing: var(--letter-spacing-subtle);
}

@media (hover: hover) {
  .mobile-toc-nav a:hover {
    background: var(--color-bg-subtle);
    color: var(--color-link);
  }
}

.mobile-toc-nav a:focus-visible {
  outline: none;
  color: var(--color-link);
  box-shadow:
    inset 0 0 0 1px var(--color-accent-40),
    0 0 0 2px var(--color-bg),
    0 0 0 4px var(--color-accent-30);
}

.mobile-toc-nav a.active {
  background: var(--color-accent-10);
  color: var(--color-link);
}

/* ======================
 * Reading Progress Bar
 * ====================== */
.reading-progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--border-accent);
  background: linear-gradient(
    90deg,
    var(--color-accent),
    var(--color-gradient-purple)
  );
  z-index: var(--z-header);
  /* Use transform for GPU-accelerated animation instead of width */
  transform: scaleX(0);
  transform-origin: left;
  transition: transform var(--animation-progress) ease-out;
  box-shadow: 0 0 8px var(--color-accent-40);
  will-change: transform;
}

/* ======================
 * Responsive Adjustments
 * ====================== */
@media (max-width: 640px) {
  .footer-nav {
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .footer-cta {
    padding: var(--spacing-lg);
  }

  .page-title {
    font-size: var(--font-size-8xl);
  }

  .page-subtitle {
    font-size: var(--font-size-xl);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .cta-primary,
  .contact-btn {
    transition: none;
  }
}

/* ======================
 * Related Articles Section
 * Shared across PostLayout, CaseStudyLayout, and ADR pages
 * ====================== */
.related-articles {
  margin-top: var(--spacing-3xl);
  padding-top: var(--spacing-xl);
  border-top: none;
  position: relative;
}

.related-articles::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    var(--color-accent-30) 20%,
    var(--color-gradient-purple-20) 80%,
    transparent
  );
}

.related-articles h2 {
  font-size: var(--font-size-5xl);
  font-weight: var(--font-weight-semibold);
  letter-spacing: var(--letter-spacing-snug);
  margin-bottom: var(--spacing-lg);
  color: var(--color-text);
}

.related-intro {
  font-size: var(--font-size-md);
  color: var(--color-text-muted);
  margin-bottom: var(--spacing-lg);
}

.related-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-md);
}

.related-card {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-lg);
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-left: 3px solid var(--color-accent-30);
  border-radius: var(--radius-lg);
  text-decoration: none;
  transition: all var(--transition-bounce);
  overflow: hidden;
}

@media (hover: hover) {
  .related-card:hover {
    border-color: var(--color-border-hover);
    border-left-color: var(--color-accent);
    background: linear-gradient(
      135deg,
      var(--color-bg-subtle) 0%,
      var(--color-accent-5) 100%
    );
    transform: translateY(var(--lift-sm));
    box-shadow: var(--shadow-md);
    text-decoration: none;
  }

  .related-card:hover .related-title {
    color: var(--color-accent);
  }
}

.related-card:focus-visible {
  outline: none;
  box-shadow:
    inset 0 0 0 2px var(--color-accent-40),
    0 0 0 3px var(--color-bg),
    0 0 0 5px var(--color-accent-30);
}

.related-card:focus-visible .related-title {
  color: var(--color-accent);
}

.related-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  letter-spacing: var(--letter-spacing-compact);
  color: var(--color-text);
  line-height: var(--line-height-snug);
}

.related-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  line-height: var(--line-height-loose);
  letter-spacing: var(--letter-spacing-slight);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.related-meta-row {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
  margin-top: var(--spacing-xs);
}

.related-date {
  font-size: var(--font-size-2xs);
  color: var(--color-text-subtle);
  white-space: nowrap;
}

.related-tags {
  display: flex;
  gap: var(--spacing-xs);
  flex-wrap: wrap;
}

.related-tag {
  font-size: var(--font-size-2xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--color-bg);
  border: 1px solid var(--color-border-subtle);
  border-radius: var(--radius-full);
  color: var(--color-text-subtle);
}

@media (max-width: 640px) {
  .related-grid {
    grid-template-columns: 1fr;
  }
}
