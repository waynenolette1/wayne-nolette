:root {
  /* Typography - Font Families */
  --font-body:
    'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
    Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
  --font-mono:
    'JetBrains Mono', 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono',
    'Droid Sans Mono', 'Source Code Pro', monospace;
  --font-display: 'Space Grotesk', 'DM Sans', -apple-system, sans-serif;

  /* Typography - Font Sizes (Expanded Scale) */
  --font-size-2xs: 0.75rem; /* 12px - labels, badges */
  --font-size-xs: 0.8125rem; /* 13px - small text, captions */
  --font-size-sm: 0.875rem; /* 14px - secondary text */
  --font-size-base: 0.9375rem; /* 15px - body text */
  --font-size-md: 1rem; /* 16px - body text medium */
  --font-size-lg: 1.0625rem; /* 17px - body text large */
  --font-size-xl: 1.125rem; /* 18px - large body */
  --font-size-2xl: 1.25rem; /* 20px - article body */
  --font-size-3xl: 1.5rem; /* 24px - lead text */
  --font-size-4xl: 1.75rem; /* 28px - intro paragraphs */
  --font-size-5xl: 2rem; /* 32px - descriptions */
  --font-size-6xl: 2.25rem; /* 36px - h4, small headings */
  --font-size-7xl: 2.75rem; /* 44px - h3 */
  --font-size-8xl: 3.25rem; /* 52px - h2 */
  --font-size-9xl: 3.75rem; /* 60px - h1 */
  --font-size-stat: 2rem; /* 32px - stat values */

  /* Typography - Font Weights */
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --font-weight-extrabold: 800;

  /* Typography - Line Heights */
  --line-height-none: 1;
  --line-height-tighter: 1.1;
  --line-height-tight: 1.2;
  --line-height-snug: 1.3;
  --line-height-normal: 1.4;
  --line-height-relaxed: 1.6;
  --line-height-loose: 1.7;
  --line-height-looser: 1.75;
  --line-height-prose: 1.8;

  /* Typography - Letter Spacing */
  --letter-spacing-tighter: -0.03em;
  --letter-spacing-tight: -0.02em;
  --letter-spacing-semitight: -0.015em;
  --letter-spacing-snug: -0.01em;
  --letter-spacing-compact: -0.005em;
  --letter-spacing-normal: 0;
  --letter-spacing-slight: 0.005em;
  --letter-spacing-subtle: 0.01em;
  --letter-spacing-relaxed: 0.02em;
  --letter-spacing-wide: 0.03em;
  --letter-spacing-wider: 0.05em;
  --letter-spacing-widest: 0.08em;
  --letter-spacing-caps: 0.1em;

  /* Monochromatic Dark Theme - Single Theme Only */
  --color-bg: #060608;
  --color-bg-subtle: #0c0c10;
  --color-bg-elevated: #14141a;

  --color-text: #ededed;
  --color-text-muted: #c0c0c0; /* 6.8:1 contrast on bg - improved for readability */
  --color-text-subtle: #a8a8a8; /* 5.8:1 contrast - WCAG AA compliant */

  --color-border: #1e2028;
  --color-border-hover: #2a2d38;
  --color-border-subtle: #14161c;

  /* Single Accent Color */
  --color-accent: #0891b2;

  /* Accent color with opacity variants (for backgrounds, highlights) */
  --color-accent-5: rgba(6, 182, 212, 0.05);
  --color-accent-08: rgba(6, 182, 212, 0.08);
  --color-accent-10: rgba(6, 182, 212, 0.1);
  --color-accent-15: rgba(6, 182, 212, 0.15);
  --color-accent-20: rgba(6, 182, 212, 0.2);
  --color-accent-25: rgba(6, 182, 212, 0.25);
  --color-accent-30: rgba(6, 182, 212, 0.3);
  --color-accent-35: rgba(6, 182, 212, 0.35);
  --color-accent-40: rgba(6, 182, 212, 0.4);
  --color-accent-50: rgba(6, 182, 212, 0.5);
  --color-accent-70: rgba(6, 182, 212, 0.7);
  --color-accent-80: rgba(6, 182, 212, 0.8);

  /* Link colors */
  --color-link: #06b6d4;
  --color-link-hover: #22d3ee;
  --color-link-visited: #67e8f9;

  /* Link color with opacity variants */
  --color-link-15: rgba(6, 182, 212, 0.15);
  --color-link-20: rgba(6, 182, 212, 0.2);
  --color-link-25: rgba(6, 182, 212, 0.25);
  --color-link-35: rgba(6, 182, 212, 0.35);

  /* Gradient colors - used across site for visual interest */
  --color-gradient-purple: #0891b2;
  --color-gradient-pink: #14b8a6;
  --color-gradient-indigo: #0e7490;
  --color-gradient-cyan: #06b6d4;

  /* Gradient purple with opacity variants */
  --color-gradient-purple-5: rgba(8, 145, 178, 0.05);
  --color-gradient-purple-06: rgba(8, 145, 178, 0.06);
  --color-gradient-purple-08: rgba(8, 145, 178, 0.08);
  --color-gradient-purple-10: rgba(8, 145, 178, 0.1);
  --color-gradient-purple-15: rgba(8, 145, 178, 0.15);
  --color-gradient-purple-20: rgba(8, 145, 178, 0.2);
  --color-gradient-purple-25: rgba(8, 145, 178, 0.25);
  --color-gradient-purple-30: rgba(8, 145, 178, 0.3);
  --color-gradient-purple-40: rgba(8, 145, 178, 0.4);
  --color-gradient-purple-50: rgba(8, 145, 178, 0.5);
  --color-gradient-purple-80: rgba(8, 145, 178, 0.8);

  /* Gradient indigo (14, 116, 144) with opacity variants */
  --color-gradient-indigo-10: rgba(14, 116, 144, 0.1);

  /* Gradient violet (8, 145, 178) with opacity variants */
  --color-gradient-violet-06: rgba(8, 145, 178, 0.06);

  /* Gradient fuchsia (20, 184, 166) with opacity variants */
  --color-gradient-fuchsia-04: rgba(20, 184, 166, 0.04);

  /* Success color with opacity variants */
  --color-success-05: rgba(16, 185, 129, 0.05);
  --color-success-08: rgba(16, 185, 129, 0.08);
  --color-success-10: rgba(16, 185, 129, 0.1);
  --color-success-15: rgba(16, 185, 129, 0.15);
  --color-success-20: rgba(16, 185, 129, 0.2);
  --color-success-30: rgba(16, 185, 129, 0.3);
  --color-success-50: rgba(16, 185, 129, 0.5);
  --color-success-60: rgba(16, 185, 129, 0.6);
  --color-success-80: rgba(16, 185, 129, 0.8);

  /* Backdrop overlay */
  --color-backdrop: rgba(0, 0, 0, 0.7);

  --color-success: #34d399;
  --color-warning: #f59e0b;
  --color-error: #ef4444;

  /* Error color with opacity variant */
  --color-error-60: rgba(239, 68, 68, 0.6);

  /* Subtle white/black overlays */
  --color-overlay-white-02: rgba(255, 255, 255, 0.02);
  --color-overlay-white-05: rgba(255, 255, 255, 0.05);
  --color-overlay-white-15: rgba(255, 255, 255, 0.15);
  --color-overlay-white-20: rgba(255, 255, 255, 0.2);
  --color-overlay-white-90: rgba(255, 255, 255, 0.9);
  --color-overlay-black-10: rgba(0, 0, 0, 0.1);
  --color-overlay-black-15: rgba(0, 0, 0, 0.15);
  --color-overlay-black-20: rgba(0, 0, 0, 0.2);
  --color-overlay-black-30: rgba(0, 0, 0, 0.3);
  --color-overlay-black-60: rgba(0, 0, 0, 0.6);
  --color-overlay-black-80: rgba(0, 0, 0, 0.8);
  --color-overlay-black-95: rgba(0, 0, 0, 0.95);

  /* Dark theme header backgrounds */
  --color-header-dark: rgba(6, 6, 8, 0.95);
  --color-header-dark-glass: rgba(17, 24, 39, 0.95);
  --color-header-dark-glass-blur: rgba(17, 24, 39, 0.9);

  /* Education decorative colors */
  --color-edu-gatech: #b3a369;
  --color-edu-gatech-08: rgba(179, 163, 105, 0.08);
  --color-edu-edinburgh: #003366;
  --color-edu-edinburgh-08: rgba(0, 51, 102, 0.08);

  /* Skip link color (darker blue for WCAG AA contrast 6.5:1 with white) */
  --color-skip-link: #1d4ed8;

  /* Mask gradient (pure white for CSS masks) */
  --color-mask-white: #fff;

  /* Warning color with opacity variants */
  --color-warning-05: rgba(245, 158, 11, 0.05);
  --color-warning-08: rgba(245, 158, 11, 0.08);
  --color-warning-15: rgba(245, 158, 11, 0.15);
  --color-warning-20: rgba(245, 158, 11, 0.2);
  --color-warning-30: rgba(245, 158, 11, 0.3);
  --color-warning-80: rgba(245, 158, 11, 0.8);

  /* Pink gradient with opacity variants */
  --color-gradient-pink-05: rgba(236, 72, 153, 0.05);
  --color-gradient-pink-15: rgba(236, 72, 153, 0.15);
  --color-gradient-pink-30: rgba(236, 72, 153, 0.3);

  /* Button text - for buttons with gradient/solid backgrounds */
  --color-btn-text: #ffffff;

  /* Code blocks */
  --color-code-bg: #0c0c10;
  --color-code-border: #1e2028;

  /* Syntax highlighting colors */
  --color-syntax-string: #34d399;
  --color-syntax-function: #22d3ee;
  --color-syntax-number: #fbbf24;
  --color-syntax-type: #22d3ee;
  --color-syntax-keyword: #67e8f9;

  /* Print colors */
  --color-print-text: #000;
  --color-print-bg: #fff;
  --color-print-muted: #666;

  /* Layout */
  --max-width: 1200px;
  --header-height: 56px;
  /* Total header height including safe area for content offset */
  --header-total-height: calc(
    var(--header-height) + env(safe-area-inset-top, 0px)
  );
  /* iOS safe area insets - fallback to 0 for non-supporting browsers */
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);

  /* Breakpoints (reference only — use raw values in @media queries)
   *   400px  — xs: iPhone SE / extra-small phones
   *   640px  — sm: mobile-first primary breakpoint
   *   768px  — md: table horizontal scroll (components.css)
   *   900px  — lg: medium screens, grid layout shifts (index.astro)
   *  1100px  — xl: desktop with TOC sidebar (ArticleLayout, CaseStudyLayout)
   */

  /* Spacing - Increased for cleaner layout */
  --spacing-2xs: 0.125rem; /* 2px - for fine decorative elements */
  --spacing-xs: 0.25rem; /* 4px */
  --spacing-sm: 0.5rem; /* 8px */
  --spacing-md: 1rem;
  --spacing-lg: 2rem; /* increased from 1.5rem */
  --spacing-xl: 4rem;
  --spacing-2xl: 6rem;
  --spacing-3xl: 8rem;
  --spacing-mobile-edge: 1.25rem; /* 20px - mobile horizontal padding */

  /* Shadows - Subtle for dark theme (5-level elevation system) */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.2);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.2);
  --shadow-lg:
    0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.3);
  --shadow-xl:
    0 20px 25px -5px rgb(0 0 0 / 0.5), 0 8px 10px -6px rgb(0 0 0 / 0.3);
  --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.6);
  /* Accent-colored shadows for interactive elements */
  --shadow-accent-subtle: 0 4px 12px -2px rgba(8, 145, 178, 0.3);

  /* Transitions - Unified timing system */
  --transition-fast: 100ms ease;
  --transition-base: 200ms ease;
  --transition-slow: 300ms ease;
  --transition-slower: 400ms ease;
  --transition-slowest: 500ms ease;
  --transition-smooth: 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
  --transition-bounce: 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
  --transition-snap: 150ms cubic-bezier(0.4, 0, 0.2, 1);

  /* Animation durations - for keyframe animations */
  --animation-fade: 100ms;
  --animation-fade-in: 0.5s;
  --animation-fade-in-slow: 0.6s;
  --animation-shimmer: 750ms;
  --animation-spin: 1s;
  --animation-pulse: 2s;

  --animation-progress: 50ms;
  --animation-gradient: 3s;

  --animation-float: 8s;
  --animation-glitch: 2.5s;

  /* Stagger delays - for cascading animations */
  --delay-05: 0.05s;
  --delay-1: 0.1s;
  --delay-2: 0.2s;
  --delay-3: 0.3s;
  --delay-4: 0.4s;
  --delay-5: 0.5s;

  /* Translation distances - for slide animations */
  --translate-4xs: 1px;
  --translate-3xs: 2px;
  --translate-2xs: 3px;
  --translate-xs: 4px;
  --translate-2sm: 8px;
  --translate-sm: 10px;
  --translate-3sm: 12px;
  --translate-4sm: 16px;
  --translate-md: 20px;
  --translate-offscreen: 400px;

  /* Border widths - consistent accent borders */
  --border-divider: 1px;
  --border-accent: 3px;
  --border-highlight: 4px;

  /* Glass morphism blur values */
  --blur-xs: 4px;
  --blur-sm: 6px;
  --blur-md: 8px;
  --blur-lg: 10px;
  --blur-xl: 12px;
  --blur-2xl: 15px;
  --blur-3xl: 40px;

  /* Interactive scale transforms */
  --scale-press: 0.98;
  --scale-lift: 1.02;
  --scale-subtle: 1.05;
  --scale-hover: 1.1;
  --scale-shrink: 0.95;

  /* Hover lift amounts - vertical displacement on hover */
  --lift-subtle: -1px;
  --lift-sm: -2px;
  --lift-md: -3px;
  --lift-lg: -4px;

  /* Touch targets - Apple HIG compliant */
  --touch-target: 44px;

  /* Icon sizes */
  --icon-size-sm: 16px;
  --icon-size-md: 20px;

  /* Card system - glassmorphism */
  --card-bg: rgba(12, 12, 18, 0.5);
  --card-border: 1px solid rgba(255, 255, 255, 0.06);
  --card-radius: var(--radius-xl);
  --card-shadow-hover:
    0 8px 32px -4px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.08) inset;
  --card-backdrop-blur: 12px;
  --card-glow-accent: 0 0 40px -10px rgba(8, 145, 178, 0.15);

  /* Layout dimensions */
  --toc-width: 220px;
  --content-max-width: 680px;
  --header-accent-width: 120px;

  /* Opacity utilities */
  --opacity-half: 0.5;
  --opacity-muted: 0.6;
  --opacity-soft: 0.7;
  --opacity-medium: 0.8;

  --opacity-strong: 0.9;

  /* Component sizes - common interactive element dimensions */
  --size-sm: 8px;
  --size-xl: 14px;
  --size-2xl: 24px;
  --size-3xl: 32px;
  --size-4xl: 36px;
  --size-8xl: 50px;

  /* Outline - focus ring styling */
  --outline-width: 2px;
  --outline-offset-sm: 2px;
  --outline-offset-inset: -2px;

  /* Em-based spacing - relative to font context */
  --em-xs: 0.25em;
  --em-md: 0.4em;
  --em-lg: 0.5em;

  /* Card shadows - elevation system */
  --shadow-card: 0 4px 12px var(--color-accent-15);

  /* Border radius */
  --radius-xs: 1px;
  --radius-2xs: 2px;
  --radius-sm: 4px;
  --radius-md: 6px;
  --radius-lg: 8px;
  --radius-xl: 12px;
  --radius-full: 9999px;

  /* Z-index scale (centralized to avoid conflicts) */
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-header: 500;
  --z-mobile-backdrop: 900;
  --z-mobile-menu: 950;
  --z-toast: 1000;
  --z-modal: 1100;
  --z-lightbox: 1200;
  --z-loader: 1300;
  --z-skip-link: 1400;

  /* Glassmorphism (dark theme) */
  --glass-bg: rgba(6, 6, 8, 0.8);
  --glass-blur: 12px;
  /* Increased from 0.05 for better visibility */
  --glass-border: rgba(255, 255, 255, 0.12);
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  font-family: var(--font-body);
  font-size: 1rem;
  line-height: var(--line-height-loose);
  color: var(--color-text);
  background-color: var(--color-bg);
  color-scheme: dark;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

body {
  margin: 0;
  padding: 0;
  /* Use dvh (dynamic viewport height) for iOS Safari to avoid the address bar jump */
  /* Falls back to vh for browsers that don't support dvh */
  min-height: 100vh;
  min-height: 100dvh;
  /* iOS safe area support for landscape orientation */
  padding-left: env(safe-area-inset-left, 0px);
  padding-right: env(safe-area-inset-right, 0px);
}

main {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: var(--spacing-xl) var(--spacing-lg);
  /* Ensure content scrolls smoothly past sticky header on iOS */
  scroll-margin-top: var(--header-total-height);
}

/* Responsive main padding for smaller devices */
@media (max-width: 640px) {
  main {
    padding: var(--spacing-lg) var(--spacing-mobile-edge);
  }
}

/* Extra small screens (iPhone SE, older devices) */
@media (max-width: 400px) {
  main {
    /* Slightly reduced vertical padding on extra small screens */
    padding: var(--spacing-md) var(--spacing-mobile-edge);
  }
}

/* Scroll margin for anchor links to account for sticky header */
:target {
  scroll-margin-top: var(--header-total-height);
}

/* Premium anchor target highlight animation */
:target:not(main) {
  animation: targetHighlight 2s ease-out;
}

@keyframes targetHighlight {
  0% {
    background: linear-gradient(
      90deg,
      var(--color-accent-20) 0%,
      var(--color-gradient-purple-15) 50%,
      transparent 100%
    );
    box-shadow: -4px 0 0 var(--color-accent);
  }
  100% {
    background: transparent;
    box-shadow: none;
  }
}

/* Typography */
h1,
h2,
h3,
h4,
h5 {
  margin-top: var(--spacing-2xl);
  margin-bottom: var(--spacing-md);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-snug);
  letter-spacing: var(--letter-spacing-tight);
  color: var(--color-text);
  /* Ensure anchor links scroll past sticky header */
  scroll-margin-top: var(--header-total-height);
}

h1,
h2 {
  font-family: var(--font-display);
  font-weight: var(--font-weight-normal);
}

h3,
h4,
h5 {
  font-family: var(--font-body);
}

h1 {
  font-size: clamp(2.25rem, 5vw, var(--font-size-9xl));
  margin-top: 0;
  letter-spacing: var(--letter-spacing-tighter);
  line-height: var(--line-height-tight);
}

h2 {
  font-size: clamp(var(--font-size-5xl), 3.5vw, var(--font-size-8xl));
  padding-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
  /* Subtle text shadow for depth perception */
  text-shadow: 0 1px 2px var(--color-overlay-black-15);
}

h3 {
  font-size: clamp(var(--font-size-xl), 2.5vw, var(--font-size-3xl));
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  /* Subtle text shadow for depth */
  text-shadow: 0 1px 1px var(--color-overlay-black-10);
}

h4 {
  font-size: clamp(var(--font-size-lg), 2vw, var(--font-size-3xl));
  color: var(--color-text-muted);
}

p {
  margin: 0 0 var(--spacing-md);
  letter-spacing: var(--letter-spacing-slight);
}

/* Links */
a {
  color: var(--color-link);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:visited {
  color: var(--color-link-visited);
}

/* Only apply hover styles on devices that support hover */
@media (hover: hover) {
  a:hover {
    color: var(--color-link-hover);
    text-decoration: none;
  }
}

/* Premium animated underline for content links */
.post-content a,
.study-content a,
article p a,
article li a {
  position: relative;
  text-decoration: none;
}

.post-content a::after,
.study-content a::after,
article p a::after,
article li a::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 100%;
  height: 1px;
  background: linear-gradient(
    90deg,
    var(--color-link),
    var(--color-gradient-purple)
  );
  /* Use transform instead of width for better GPU performance */
  transform: scaleX(0);
  transform-origin: left;
  transition: transform var(--transition-base) ease;
}

@media (hover: hover) {
  .post-content a:hover::after,
  .study-content a:hover::after,
  article p a:hover::after,
  article li a:hover::after {
    transform: scaleX(1);
  }
}

/*
 * iOS Safari tap state normalization
 * Remove default tap highlight that can cause low contrast issues.
 * Interactive elements should define their own :active states.
 */
a,
button,
[role='button'],
input[type='button'],
input[type='submit'] {
  -webkit-tap-highlight-color: transparent;
  /* Eliminate 300ms touch delay on mobile */
  touch-action: manipulation;
}

/* Eliminate touch delay on all interactive elements */
a,
button,
[role='button'],
input,
select,
textarea,
label {
  touch-action: manipulation;
}

/*
 * Base button transitions
 * Ensure all buttons have smooth transitions for consistent feel.
 */
button,
[role='button'],
input[type='button'],
input[type='submit'] {
  transition:
    background-color var(--transition-fast),
    border-color var(--transition-fast),
    color var(--transition-fast),
    transform var(--transition-snap),
    box-shadow var(--transition-fast),
    opacity var(--transition-fast);
}

button:active,
[role='button']:active,
input[type='button']:active,
input[type='submit']:active {
  transform: scale(var(--scale-press));
}

/* Premium touch feedback - snappy response on mobile */
@media (pointer: coarse) {
  a:active,
  button:active,
  [role='button']:active {
    transition: transform 0.05s ease-out !important;
  }
}

/* Screen reader only - visually hidden but accessible to assistive technology */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Lists */
ul,
ol {
  padding-left: var(--spacing-lg);
  margin: 0 0 var(--spacing-md);
}

li {
  margin-bottom: var(--spacing-xs);
  letter-spacing: var(--letter-spacing-slight);
}

li::marker {
  color: var(--color-text-muted);
}

/* Code */
code {
  font-family: var(--font-mono);
  font-size: var(--font-size-base);
  background-color: var(--color-code-bg);
  border: 1px solid var(--color-code-border);
  padding: 0.15em 0.4em;
  border-radius: var(--radius-sm);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-snug);
  /* Prevent long inline code from causing overflow */
  word-break: break-word;
  overflow-wrap: break-word;
  position: relative;
  transition: all var(--transition-base) cubic-bezier(0.22, 1, 0.36, 1);
}

/* Subtle glow effect for inline code on hover */
@media (hover: hover) {
  code:hover {
    border-color: var(--color-accent-25);
    background-color: var(--color-accent-5);
    box-shadow: 0 0 10px var(--color-accent-10);
  }
}

pre {
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  line-height: var(--line-height-relaxed);
  letter-spacing: var(--letter-spacing-snug);
  background-color: var(--color-code-bg);
  border: 1px solid var(--color-code-border);
  padding: var(--spacing-md);
  border-radius: var(--radius-lg);
  overflow-x: auto;
  margin: var(--spacing-lg) 0;
  /* Make scrollbar more visible */
  scrollbar-width: thin;
  scrollbar-color: var(--color-text-muted) var(--color-bg-subtle);
  position: relative;
  transition:
    border-color var(--transition-slow),
    box-shadow var(--transition-slow);
}

@media (hover: hover) {
  pre:hover {
    border-color: var(--color-accent-30);
    box-shadow: 0 2px 12px var(--color-accent-10);
  }
}

pre::-webkit-scrollbar {
  height: 8px;
}

pre::-webkit-scrollbar-track {
  background: var(--color-bg-subtle);
  border-radius: var(--radius-sm);
}

pre::-webkit-scrollbar-thumb {
  background: var(--color-text-muted);
  border-radius: var(--radius-sm);
}

pre::-webkit-scrollbar-thumb:hover {
  background: var(--color-text);
}

pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: inherit;
}

/* Syntax highlighting - dark theme only */
/* Shiki sets --shiki-dark and --shiki-dark-bg; fallback to theme colors if unavailable */
.shiki,
.shiki span {
  color: var(--shiki-dark, var(--color-text)) !important;
  background-color: var(--shiki-dark-bg, var(--color-code-bg)) !important;
}

/* Blockquotes */
blockquote {
  margin: var(--spacing-lg) 0;
  padding: var(--spacing-md) var(--spacing-xl) var(--spacing-md)
    calc(var(--spacing-lg) + var(--spacing-md));
  border-left: none;
  background: linear-gradient(
    135deg,
    var(--color-bg-subtle) 0%,
    var(--color-accent-5) 100%
  );
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  font-style: italic;
  letter-spacing: var(--letter-spacing-slight);
  position: relative;
  overflow: hidden;
  transition: all var(--transition-slow) cubic-bezier(0.22, 1, 0.36, 1);
}

/* Static gradient left border for blockquotes */
blockquote::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: var(--border-accent);
  background: linear-gradient(
    180deg,
    var(--color-accent),
    var(--color-gradient-purple)
  );
  border-radius: var(--radius-md) 0 0 var(--radius-md);
}

/* Blockquote hover state */
@media (hover: hover) {
  blockquote:hover {
    background: linear-gradient(
      135deg,
      var(--color-bg-subtle) 0%,
      var(--color-accent-08) 100%
    );
    box-shadow: 0 2px 12px var(--color-accent-10);
  }
}

/* Decorative quotation mark */
blockquote::after {
  content: '\201C';
  position: absolute;
  top: var(--spacing-xs);
  right: var(--spacing-sm);
  font-size: 3.5rem;
  font-family: Georgia, serif;
  line-height: 1;
  background: linear-gradient(
    135deg,
    var(--color-accent-20),
    var(--color-gradient-purple-15)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  pointer-events: none;
  z-index: 0;
}

blockquote p:last-child {
  margin-bottom: 0;
}

/* Horizontal rule - clean gradient fade */
hr {
  border: none;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    var(--color-border-hover) 20%,
    var(--color-accent-30) 50%,
    var(--color-border-hover) 80%,
    transparent
  );
  margin: var(--spacing-2xl) 0;
}

/* Tables - Base Reset
 * Main table styling is in components.css (.table-scroll)
 * These are minimal fallback styles for tables outside content areas */
table {
  border-collapse: collapse;
  font-size: var(--font-size-md);
  font-variant-numeric: tabular-nums;
}

th,
td {
  text-align: left;
  padding: var(--spacing-sm) var(--spacing-md);
  border-bottom: 1px solid var(--color-border-subtle);
}

th {
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  color: var(--color-text-subtle);
  background: var(--color-bg-subtle);
}

/* Images */
/* Images with lazy loading blur-up effect */
img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-md);
  transition:
    opacity var(--transition-base),
    filter var(--transition-base);
}

img[loading='lazy'] {
  opacity: 0;
  filter: blur(var(--blur-lg));
}

img[loading='lazy'].loaded {
  opacity: 1;
  filter: blur(0);
}

/* Skeleton loader for images - staggered shimmer timing */
img[loading='lazy']:not(.loaded) {
  background: linear-gradient(
    90deg,
    var(--color-bg-subtle) 25%,
    var(--color-bg-elevated) 50%,
    var(--color-bg-subtle) 75%
  );
  background-size: 200% 100%;
  animation: shimmerBg var(--animation-shimmer) ease-in-out infinite;
  /* Stagger delay prevents synchronized "flashing" effect */
  animation-delay: var(--shimmer-delay, 0ms);
}

/* Stagger shimmer for multiple images */
img[loading='lazy']:not(.loaded):nth-of-type(2) {
  --shimmer-delay: 150ms;
}
img[loading='lazy']:not(.loaded):nth-of-type(3) {
  --shimmer-delay: 300ms;
}
img[loading='lazy']:not(.loaded):nth-of-type(4) {
  --shimmer-delay: 450ms;
}
img[loading='lazy']:not(.loaded):nth-of-type(5) {
  --shimmer-delay: 600ms;
}

@keyframes shimmerBg {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

/* Strong/Bold */
strong {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

/* ======================
 * Semantic Elements for Technical Documentation
 * ====================== */

/* Keyboard input - subtle mechanical key appearance */
kbd {
  display: inline-block;
  padding: 0.15em 0.4em;
  font-family: var(--font-mono);
  font-size: 0.85em;
  font-weight: var(--font-weight-medium);
  letter-spacing: var(--letter-spacing-snug);
  color: var(--color-text);
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-border);
  border-bottom-width: 2px;
  border-radius: var(--radius-sm);
  box-shadow: inset 0 -1px 0 var(--color-overlay-black-10);
  white-space: nowrap;
}

/* Abbreviations - dotted underline with tooltip hint */
abbr[title] {
  text-decoration: underline dotted var(--color-text-subtle);
  text-underline-offset: 3px;
  cursor: help;
  letter-spacing: var(--letter-spacing-subtle);
}

@media (hover: hover) {
  abbr[title]:hover {
    text-decoration-color: var(--color-accent);
  }
}

/* Highlighted/marked text - subtle accent background */
mark {
  background: linear-gradient(
    135deg,
    var(--color-accent-20) 0%,
    var(--color-gradient-purple-15) 100%
  );
  color: var(--color-text);
  padding: 0.1em 0.3em;
  border-radius: var(--radius-xs);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

/* Definition lists - clean technical reference styling */
dl {
  margin: var(--spacing-lg) 0;
}

dt {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-top: var(--spacing-md);
  letter-spacing: var(--letter-spacing-snug);
}

dt:first-child {
  margin-top: 0;
}

dd {
  margin-left: var(--spacing-lg);
  margin-bottom: var(--spacing-sm);
  color: var(--color-text-muted);
  letter-spacing: var(--letter-spacing-slight);
}

/* Figure and caption styling */
figure {
  margin: var(--spacing-xl) 0;
}

figcaption {
  margin-top: var(--spacing-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-subtle);
  text-align: center;
  font-style: italic;
  letter-spacing: var(--letter-spacing-subtle);
}

/* Small text */
small {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  letter-spacing: var(--letter-spacing-subtle);
}

/* Subscript and superscript */
sub,
sup {
  font-size: 0.75em;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

/* Variable/sample output - technical emphasis */
var {
  font-family: var(--font-mono);
  font-style: italic;
  color: var(--color-accent);
  letter-spacing: var(--letter-spacing-snug);
}

samp {
  font-family: var(--font-mono);
  font-size: 0.9em;
  background: var(--color-bg-subtle);
  padding: 0.1em 0.3em;
  border-radius: var(--radius-xs);
  letter-spacing: var(--letter-spacing-snug);
}

/* Details/Summary - Collapsible sections */
details {
  margin: var(--spacing-lg) 0;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  background: var(--color-bg-subtle);
  overflow: hidden;
}

summary {
  padding: var(--spacing-md) var(--spacing-lg);
  font-weight: var(--font-weight-semibold);
  letter-spacing: var(--letter-spacing-snug);
  cursor: pointer;
  list-style: none;
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  transition: all var(--transition-fast);
}

summary::-webkit-details-marker {
  display: none;
}

summary::before {
  content: '';
  width: 0;
  height: 0;
  border-left: 5px solid var(--color-text-muted);
  border-top: 4px solid transparent;
  border-bottom: 4px solid transparent;
  transition: transform var(--transition-fast);
}

details[open] summary::before {
  transform: rotate(90deg);
}

@media (hover: hover) {
  summary:hover {
    background: var(--color-bg);
    color: var(--color-link);
  }
}

details > *:not(summary) {
  padding: 0 var(--spacing-lg) var(--spacing-lg);
}

/* Inserted and deleted text - Diff styling */
ins {
  background: var(--color-success-15);
  color: var(--color-success);
  text-decoration: none;
  padding: 0.1em 0.2em;
  border-radius: var(--radius-xs);
}

del {
  background: var(--color-error-60);
  color: var(--color-text);
  text-decoration: line-through;
  text-decoration-color: var(--color-error);
  padding: 0.1em 0.2em;
  border-radius: var(--radius-xs);
  opacity: var(--opacity-medium);
}

/* Citation styling */
cite {
  font-style: italic;
  color: var(--color-text-muted);
  letter-spacing: var(--letter-spacing-slight);
}

/* Time element - subtle styling for dates */
time {
  font-variant-numeric: tabular-nums;
  letter-spacing: var(--letter-spacing-subtle);
}

/* Address - contact info styling */
address {
  font-style: normal;
  color: var(--color-text-muted);
  line-height: var(--line-height-loose);
  letter-spacing: var(--letter-spacing-slight);
}

/* Toast Notifications */
.toast {
  position: fixed;
  /* Account for iOS safe area at bottom */
  bottom: calc(var(--spacing-md) + env(safe-area-inset-bottom, 0px));
  right: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-xl);
  z-index: var(--z-toast);
  font-size: var(--font-size-md);
  font-weight: var(--font-weight-medium);
  transform: translateX(var(--translate-offscreen));
  opacity: 0;
  transition: all var(--transition-snap);
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast svg {
  flex-shrink: 0;
}

.toast span {
  color: var(--color-text);
}

@media (max-width: 640px) {
  .toast {
    left: var(--spacing-md);
    right: var(--spacing-md);
    /* Account for iOS safe area at bottom on mobile */
    bottom: calc(var(--spacing-md) + env(safe-area-inset-bottom, 0px));
  }
}

/* Keyboard Shortcuts Overlay */
.shortcuts-overlay {
  position: fixed;
  inset: 0;
  background: var(--color-overlay-black-80);
  backdrop-filter: blur(var(--blur-sm));
  -webkit-backdrop-filter: blur(var(--blur-sm));
  z-index: var(--z-modal);
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn var(--animation-fade) ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.shortcuts-modal {
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-xl);
  padding: var(--spacing-xl);
  max-width: 400px;
  width: 90%;
  box-shadow: var(--shadow-2xl);
  animation: slideUp var(--transition-snap);
}

@keyframes slideUp {
  from {
    transform: translateY(var(--translate-md));
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.shortcuts-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-lg);
  padding-bottom: var(--spacing-md);
  border-bottom: 1px solid var(--color-border);
}

.shortcuts-header h3 {
  margin: 0;
  font-size: var(--font-size-6xl);
  font-weight: var(--font-weight-semibold);
  background: linear-gradient(
    135deg,
    var(--color-accent),
    var(--color-gradient-purple)
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.shortcuts-header .close-btn {
  background: none;
  border: none;
  color: var(--color-text-muted);
  font-size: var(--font-size-9xl);
  line-height: var(--line-height-none);
  cursor: pointer;
  padding: 0;
  /* Apple HIG minimum touch target */
  min-width: var(--touch-target);
  min-height: var(--touch-target);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
}

@media (hover: hover) {
  .shortcuts-header .close-btn:hover {
    background: var(--color-bg-subtle);
    color: var(--color-text);
    transform: scale(var(--scale-hover));
  }
}

.shortcuts-header .close-btn:active {
  transform: scale(var(--scale-press));
  background: var(--color-bg-elevated);
}

.shortcuts-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.shortcut-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius-md);
  transition: background var(--transition-fast);
}

@media (hover: hover) {
  .shortcut-row:hover {
    background: var(--color-bg-subtle);
  }
}

.shortcut-row:active {
  background: var(--color-bg-elevated);
}

.shortcut-row kbd {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 32px;
  padding: var(--spacing-xs) var(--spacing-sm);
  background: linear-gradient(135deg, var(--color-bg-subtle), var(--color-bg));
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-accent);
  box-shadow: var(--shadow-sm);
}

.shortcut-row span {
  color: var(--color-text-muted);
  font-size: var(--font-size-md);
}

/* Selection - Premium highlight with subtle transparency */
::selection {
  background-color: var(--color-accent-80);
  color: var(--color-btn-text);
  text-shadow: none;
  /* Subtle rounded appearance via box-decoration-break */
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;
}

::-moz-selection {
  background-color: var(--color-accent-80);
  color: var(--color-btn-text);
  text-shadow: none;
}

/* Heading selection - more vibrant for emphasis */
h1::selection,
h2::selection,
h3::selection,
h1 *::selection,
h2 *::selection,
h3 *::selection {
  background-color: var(--color-accent);
  color: var(--color-btn-text);
}

/* Code block selection - purple accent for distinction */
pre::selection,
pre *::selection,
code::selection {
  background-color: var(--color-gradient-purple-80);
  color: var(--color-btn-text);
}

pre::-moz-selection,
pre *::-moz-selection,
code::-moz-selection {
  background-color: var(--color-gradient-purple-80);
  color: var(--color-btn-text);
}

/* ======================
 * Glassmorphism Navigation on Scroll
 * ====================== */
header.glass-nav {
  /* Fallback for browsers without backdrop-filter support */
  background: var(--color-header-dark);
  border-bottom: 1px solid var(--glass-border);
  box-shadow: var(--shadow-md);
}

/* Modern browsers with backdrop-filter support */
@supports (backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px)) {
  header.glass-nav {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
  }
}

header.glass-nav.scrolled {
  background: var(--color-header-dark);
  box-shadow:
    0 8px 32px var(--color-overlay-black-30),
    0 0 0 1px var(--color-overlay-white-05) inset,
    0 1px 0 var(--color-accent-15);
  /* Subtle entrance animation */
  animation: headerSlideIn 0.3s ease-out;
}

@keyframes headerSlideIn {
  from {
    backdrop-filter: blur(0);
    -webkit-backdrop-filter: blur(0);
    box-shadow: none;
  }
  to {
    backdrop-filter: blur(var(--blur-md));
    -webkit-backdrop-filter: blur(var(--blur-md));
    box-shadow:
      0 8px 32px var(--color-overlay-black-30),
      0 0 0 1px var(--color-overlay-white-05) inset,
      0 1px 0 var(--color-accent-15);
  }
}

/* ======================
 * Mermaid Diagrams - Production Grade
 * ====================== */

/* Pre-rendering state (code blocks) */
/* Mermaid Diagram - Loading State */
pre[data-language='mermaid'] {
  margin: var(--spacing-xl) 0;
  padding: var(--spacing-lg);
  background: var(--color-bg-subtle);
  border: var(--card-border);
  border-radius: var(--card-radius);
  text-align: center;
  color: var(--color-text-muted);
  font-size: var(--font-size-sm);
}

pre[data-language='mermaid'] code {
  display: none;
}

pre[data-language='mermaid']::before {
  content: 'Loading diagram...';
}

/* Diagram Container - Clean, minimal design with horizontal scroll */
.diagram-container {
  margin: var(--spacing-2xl) 0;
  padding: var(--spacing-xl);
  background: var(--color-bg-subtle);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-xl);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  /* Scroll shadow indicators (visible when content overflows) */
  background:
    /* Left shadow cover */
    linear-gradient(to right, var(--color-bg-subtle) 0, transparent 30px),
    /* Right shadow cover */
    linear-gradient(to left, var(--color-bg-subtle) 0, transparent 30px),
    /* Left scroll shadow */
    radial-gradient(
        farthest-side at 0 50%,
        var(--color-overlay-black-15),
        transparent
      ),
    /* Right scroll shadow */
    radial-gradient(
        farthest-side at 100% 50%,
        var(--color-overlay-black-15),
        transparent
      );
  background-position:
    left center,
    right center,
    left center,
    right center;
  background-repeat: no-repeat;
  background-size:
    40px 100%,
    40px 100%,
    15px 100%,
    15px 100%;
  background-attachment: local, local, scroll, scroll;
}

/* Mermaid diagram wrapper */
.diagram-container .mermaid {
  display: flex;
  justify-content: center;
  min-width: min-content;
  margin: 0 auto;
}

/* SVG rendering - natural width for readability, scroll when wider than container */
.mermaid svg {
  display: block;
  height: auto;
  shape-rendering: geometricPrecision;
  text-rendering: optimizeLegibility;
}

/* Error state */
.diagram-error {
  padding: var(--spacing-lg);
  text-align: center;
  color: var(--color-text-muted);
}

/* Mobile - full width with tighter padding */
@media (max-width: 640px) {
  .diagram-container {
    margin-left: calc(-1 * var(--spacing-md));
    margin-right: calc(-1 * var(--spacing-md));
    border-radius: 0;
    border-left: none;
    border-right: none;
    padding: var(--spacing-md);
  }
}

/* Print styles */
@media print {
  .diagram-container {
    border: 1px solid var(--color-print-text);
    page-break-inside: avoid;
    overflow: visible;
  }
}

/* Focus states for accessibility */
a:focus-visible,
button:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[tabindex]:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 3px var(--color-bg),
    0 0 0 5px var(--color-accent);
  border-radius: var(--radius-sm);
  transition: box-shadow var(--transition-fast);
}

/* Smooth scrolling - respect user preference */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}

/* Page transition animations */
@keyframes fadeInSlide {
  from {
    opacity: 0;
    transform: translateY(var(--translate-sm));
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Simple fade-in for page content - no stagger to avoid CLS */
main {
  animation: fadeInSlide var(--animation-fade) ease-out;
}

/* Respect user preference for reduced motion */
@media (prefers-reduced-motion: reduce) {
  /* Global animation and transition disable */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  main {
    animation: none;
  }
}

/* ======================
 * Simple Scrollbar Styling
 * ====================== */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: var(--color-bg-subtle);
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-full);
  border: 2px solid var(--color-bg-subtle);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-subtle);
}

/* Firefox scrollbar styling */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) var(--color-bg-subtle);
}

/* ======================
 * Scroll Progress Indicator
 * ====================== */
.scroll-progress-bar {
  position: fixed;
  top: env(safe-area-inset-top, 0px);
  left: 0;
  width: 0%;
  height: var(--border-accent);
  background: linear-gradient(
    90deg,
    var(--color-accent),
    var(--color-gradient-purple)
  );
  z-index: var(--z-header);
  transition: width var(--animation-progress) linear;
  box-shadow: 0 0 8px var(--color-accent-40);
}

/* ======================
 * Reduced Motion Support
 * ====================== */
@media (prefers-reduced-motion: reduce) {
  tbody tr,
  tbody tr::before,
  pre::before,
  pre::after,
  code {
    transition: none;
  }

  tbody tr:hover {
    transform: none;
  }
}

/* Mobile responsive fixes */
@media (max-width: 640px) {
  html {
    overflow-x: hidden;
  }

  body {
    overflow-x: hidden;
    width: 100%;
  }

  main {
    /* Ensure adequate horizontal padding with safe-area support for notched devices */
    padding-top: var(--spacing-lg);
    padding-bottom: var(--spacing-lg);
    padding-left: max(
      var(--spacing-mobile-edge),
      env(safe-area-inset-left, 0px)
    );
    padding-right: max(
      var(--spacing-mobile-edge),
      env(safe-area-inset-right, 0px)
    );
    overflow-x: hidden;
    width: 100%;
    box-sizing: border-box;
  }

  /* Ensure article content respects container width */
  article {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    overflow-wrap: break-word;
    word-wrap: break-word;
  }

  /* Content wrappers need overflow control */
  .content-wrapper,
  .study-content,
  .post-content,
  .adr-content {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    /* Critical: min-width: 0 prevents grid children from overflowing */
    min-width: 0;
  }

  /* Paragraphs and text content */
  p,
  li,
  blockquote {
    overflow-wrap: break-word;
    word-wrap: break-word;
    /* Disable hyphenation - words should wrap whole, not be split */
    hyphens: none;
    -webkit-hyphens: none;
  }

  /* Code blocks - horizontal scroll with edge-to-edge on mobile */
  pre {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    /* Use viewport-based calc to prevent overflow on small screens */
    margin-left: calc(-1 * var(--spacing-mobile-edge));
    margin-right: calc(-1 * var(--spacing-mobile-edge));
    padding-left: var(--spacing-mobile-edge);
    padding-right: var(--spacing-mobile-edge);
    border-radius: 0;
    border-left: none;
    border-right: none;
    /* Constrain to viewport width to prevent horizontal scroll */
    max-width: 100vw;
    width: calc(100% + 2 * var(--spacing-mobile-edge));
  }

  pre code {
    white-space: pre;
    word-wrap: normal;
    overflow-wrap: normal;
  }

  /* Tables - edge-to-edge scrolling on mobile like code blocks */
  .table-scroll {
    margin-left: calc(-1 * var(--spacing-mobile-edge));
    margin-right: calc(-1 * var(--spacing-mobile-edge));
    padding-left: var(--spacing-mobile-edge);
    padding-right: var(--spacing-mobile-edge);
    /* Constrain to viewport width to prevent horizontal scroll */
    max-width: 100vw;
    width: calc(100% + 2 * var(--spacing-mobile-edge));
  }

  table th,
  table td {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-sm);
  }

  /* Mermaid mobile styles are handled in diagram-container above */

  h1 {
    font-size: var(--font-size-9xl);
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  h2 {
    font-size: var(--font-size-8xl);
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  h3 {
    font-size: var(--font-size-6xl);
    word-wrap: break-word;
  }

  /* Ensure images don't overflow */
  img {
    max-width: 100%;
    height: auto;
  }

  /* Fix code blocks on mobile */
  code {
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
}

/* ======================
 * Image Lightbox
 * ====================== */
.lightbox-overlay {
  position: fixed;
  inset: 0;
  background: var(--color-overlay-black-95);
  z-index: var(--z-lightbox);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-lg);
  padding-top: calc(var(--spacing-lg) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--spacing-lg) + env(safe-area-inset-bottom, 0px));
  opacity: 0;
  visibility: hidden;
  transition:
    opacity var(--transition-base),
    visibility var(--transition-base);
  cursor: zoom-out;
  -webkit-tap-highlight-color: transparent;
}

.lightbox-overlay.active {
  opacity: 1;
  visibility: visible;
}

.lightbox-overlay img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: var(--radius-md);
  transform: scale(var(--scale-shrink));
  transition: transform var(--transition-bounce);
  cursor: default;
}

.lightbox-overlay.active img {
  transform: scale(1);
}

.lightbox-close {
  position: absolute;
  top: calc(var(--spacing-md) + env(safe-area-inset-top, 0px));
  right: var(--spacing-md);
  width: var(--touch-target);
  height: var(--touch-target);
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-full);
  color: var(--color-text);
  font-size: var(--font-size-8xl);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition:
    background var(--transition-base),
    transform var(--transition-base);
  -webkit-tap-highlight-color: transparent;
}

@media (hover: hover) {
  .lightbox-close:hover {
    background: var(--color-bg-subtle);
    transform: scale(var(--scale-hover));
  }
}

.lightbox-close:active {
  background: var(--color-bg-subtle);
  transform: scale(var(--scale-hover));
}

/* Make article images zoomable on mobile */
@media (max-width: 640px) {
  article img:not(.no-zoom),
  .post-content img:not(.no-zoom) {
    cursor: zoom-in;
    transition:
      transform var(--transition-base),
      opacity var(--transition-base);
  }

  article img:not(.no-zoom):active,
  .post-content img:not(.no-zoom):active {
    transform: scale(var(--scale-press));
    opacity: var(--opacity-strong);
  }
}

@media (prefers-reduced-motion: reduce) {
  .lightbox-overlay,
  .lightbox-overlay img {
    transition: none;
  }
}

/* Print styles */
@media print {
  :root {
    --color-text: var(--color-print-text);
    --color-bg: var(--color-print-bg);
    --color-link: var(--color-print-text);
  }

  main {
    max-width: none;
    padding: 0;
  }

  .mermaid {
    break-inside: avoid;
  }

  /* Hide interactive elements that don't make sense on paper */
  .scroll-top,
  .mobile-menu-btn,
  .mobile-menu-panel,
  .mobile-menu-backdrop,
  .lightbox-overlay,
  .toast,
  .shortcuts-overlay,
  .skip-link {
    display: none !important;
  }

  /* Ensure links show their URLs (both http and https) */
  a[href^='http']::after,
  a[href^='https']::after {
    content: ' (' attr(href) ')';
    font-size: 0.8em;
    color: var(--color-print-muted);
  }

  /* Don't show URL for internal/anchor links */
  a[href^='#']::after,
  a[href^='/']::after {
    content: none;
  }
}
